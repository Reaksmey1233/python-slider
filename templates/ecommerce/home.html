{% extends 'base.html' %}

{% block title %}Home - E-Store{% endblock %}

{% block content %}
<!-- Hero Carousel -->
{% if slides %}
<div class="relative overflow-hidden bg-gray-900">
    <div class="carousel-container">
        {% for slide in slides %}
        <div class="carousel-slide {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}">
            <div class="relative h-96 md:h-[500px]">
                {% if slide.image_display %}
                    {% if slide.image_file %}
                        <img src="/{{ slide.image_display }}" alt="{{ slide.title }}" class="w-full h-full object-cover">
                    {% else %}
                        <img src="{{ slide.image_display }}" alt="{{ slide.title }}" class="w-full h-full object-cover">
                    {% endif %}
                {% else %}
                    <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-6xl"></i>
                    </div>
                {% endif %}
                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                    <div class="text-center text-white">
                        {% if slide.title %}
                        <h1 class="text-4xl md:text-6xl font-bold mb-4">{{ slide.title }}</h1>
                        {% endif %}
                        {% if slide.subtitle %}
                        <p class="text-xl md:text-2xl mb-8">{{ slide.subtitle }}</p>
                        {% endif %}
                        <a href="{% url 'product_list' %}" class="bg-primary text-white px-8 py-3 rounded-md text-lg font-semibold hover:bg-blue-600 transition duration-300">
                            Shop Now
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Carousel Controls -->
    <button class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 p-2 rounded-full transition duration-300 carousel-prev">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 p-2 rounded-full transition duration-300 carousel-next">
        <i class="fas fa-chevron-right"></i>
    </button>
    
    <!-- Carousel Indicators -->
    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
        {% for slide in slides %}
        <button class="w-3 h-3 rounded-full bg-white bg-opacity-50 hover:bg-opacity-100 transition duration-300 carousel-indicator" data-slide="{{ forloop.counter0 }}"></button>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Categories Section -->
{% if categories %}
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">Shop by Category</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            {% for category in categories %}
            <a href="{% url 'product_list_by_category' category.slug %}" class="group">
                <div class="bg-gray-100 rounded-lg p-6 text-center hover:bg-gray-200 transition duration-300">
                    <div class="w-16 h-16 bg-primary rounded-full mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-tag text-white text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800 group-hover:text-primary transition duration-300">{{ category.name }}</h3>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Products -->
{% if featured_products %}
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">Featured Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for product in featured_products %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition duration-300">
                {% if product.images_display %}
                <img src="{{ product.images_display.0 }}" alt="{{ product.name }}" class="w-full h-48 object-cover">
                {% else %}
                <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                    <i class="fas fa-image text-gray-400 text-4xl"></i>
                </div>
                {% endif %}
                <div class="p-4">
                    <h3 class="font-semibold text-lg mb-2">{{ product.name }}</h3>
                    <p class="text-gray-600 text-sm mb-3">{{ product.category.name }}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold text-primary">${{ product.price }}</span>
                        <button class="add-to-cart-btn bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-300" 
                                data-product-id="{{ product.id }}">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-8">
            <a href="{% url 'product_list' %}" class="bg-primary text-white px-8 py-3 rounded-md text-lg font-semibold hover:bg-blue-600 transition duration-300">
                View All Products
            </a>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .carousel-container {
        position: relative;
        overflow: hidden;
        height: 500px; /* Fixed height for the container */
    }
    
    .carousel-slide {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    .carousel-slide.active {
        display: block;
    }
    
    .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Carousel functionality
    let currentSlide = 0;
    const slides = document.querySelectorAll('.carousel-slide');
    const indicators = document.querySelectorAll('.carousel-indicator');
    const totalSlides = slides.length;
    
    function showSlide(index) {
        slides.forEach(slide => slide.classList.remove('active'));
        indicators.forEach(indicator => indicator.classList.remove('bg-opacity-100'));
        
        slides[index].classList.add('active');
        indicators[index].classList.add('bg-opacity-100');
        currentSlide = index;
    }
    
    function nextSlide() {
        showSlide((currentSlide + 1) % totalSlides);
    }
    
    function prevSlide() {
        showSlide((currentSlide - 1 + totalSlides) % totalSlides);
    }
    
    // Initialize first slide
    if (totalSlides > 0) {
        showSlide(0);
    }
    
    // Event listeners
    const nextBtn = document.querySelector('.carousel-next');
    const prevBtn = document.querySelector('.carousel-prev');
    
    if (nextBtn) {
        nextBtn.addEventListener('click', nextSlide);
    }
    
    if (prevBtn) {
        prevBtn.addEventListener('click', prevSlide);
    }
    
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => showSlide(index));
    });
    
    // Auto-advance carousel
    if (totalSlides > 1) {
        setInterval(nextSlide, 5000);
    }
    
    // Add to cart functionality
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            
            fetch('/add-to-cart/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    const message = document.createElement('div');
                    message.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-md z-50';
                    message.textContent = data.message;
                    document.body.appendChild(message);
                    
                    // Remove message after 3 seconds
                    setTimeout(() => {
                        message.remove();
                    }, 3000);
                    
                    // Update cart count
                    updateCartCount();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    });
</script>
{% endblock %}
